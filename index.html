<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make a Wish</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #ccc;
      font-family: 'Courier New', monospace;
      color: rgb(0, 102, 255);
      margin: 0;
      padding: 20px;
    }
    .console-window {
      max-width: 600px;
      margin: auto;
      background: #eee;
      padding: 20px;
      border: 2px solid #999;
      box-shadow: 4px 4px 0 #888;
    }
    h1 {
      margin-top: 0;
      font-size: 2em;
      letter-spacing: -1px;
    }
    button {
      font-family: inherit;
      padding: 10px 20px;
      background: rgb(0, 102, 255);
      color: white;
      border: none;
      box-shadow: 2px 2px 0 #444;
      cursor: pointer;
    }
    input[type="text"] {
      font-family: inherit;
      padding: 8px;
      margin-right: 10px;
    }
    #gallery {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    .gallery-item {
      background: white;
      padding: 5px;
      border: 1px solid #aaa;
      box-shadow: 2px 2px 0 #666;
    }
    .gallery-item img {
      max-width: 100%;
      height: auto;
      display: block;
    }
    .timestamp {
      font-size: 0.9em;
      color: black;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="console-window">
    <h1>Make a Wish</h1>
    <p id="clock">--:--:--</p>

    <div id="nameInputContainer">
      <input type="text" id="username" placeholder="Your name">
      <button onclick="saveName()">Start</button>
    </div>

    <div id="uploadSection" style="display:none;">
      <p id="uploadStatus">Upload a photo now</p>
      <input type="file" accept="image/*" capture="environment" id="photoInput" onchange="handlePhoto(event)">
    </div>

    <div id="gallerySection" style="display:none;">
      <h2>Gallery (last 24h)</h2>
      <div id="gallery"></div>
    </div>
  </div>

  <script>
    const uploadSection = document.getElementById('uploadSection');
    const gallerySection = document.getElementById('gallerySection');
    const gallery = document.getElementById('gallery');
    const clock = document.getElementById('clock');

    function updateClock() {
      const now = new Date();
      clock.textContent = now.toLocaleTimeString('en-GB');
    }
    setInterval(updateClock, 1000);

    function saveName() {
      const name = document.getElementById('username').value.trim();
      if (name) {
        localStorage.setItem('wish_name', name);
        document.getElementById('nameInputContainer').style.display = 'none';
        uploadSection.style.display = 'block';
        checkGallery();
      }
    }

    function handlePhoto(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        const dataUrl = e.target.result;
        const now = new Date();
        const entry = {
          src: dataUrl,
          time: now.toLocaleTimeString('en-GB'),
          timestamp: now.getTime()
        };

        const photos = getPhotos();
        photos.push(entry);
        localStorage.setItem("wish_photos", JSON.stringify(photos));
        checkGallery();
      };
      reader.readAsDataURL(file);

      event.target.value = "";
    }

    function getPhotos() {
      const photos = JSON.parse(localStorage.getItem("wish_photos") || "[]");
      const now = Date.now();
      const day = 24 * 60 * 60 * 1000;
      const filtered = photos.filter(p => now - p.timestamp < day);
      localStorage.setItem("wish_photos", JSON.stringify(filtered));
      return filtered;
    }

    function checkGallery() {
      const photos = getPhotos();
      if (photos.length > 0) {
        gallerySection.style.display = 'block';
        showGallery();
      } else {
        gallerySection.style.display = 'none';
      }
    }

    function showGallery() {
      const photos = getPhotos();
      gallery.innerHTML = "";
      photos.forEach(p => {
        const wrapper = document.createElement("div");
        wrapper.className = "gallery-item";

        const img = document.createElement("img");
        img.src = p.src;

        const stamp = document.createElement("div");
        stamp.className = "timestamp";
        stamp.textContent = `Time: ${p.time}`;

        wrapper.appendChild(img);
        wrapper.appendChild(stamp);
        gallery.appendChild(wrapper);
      });
    }

    window.onload = () => {
      const name = localStorage.getItem('wish_name');
      if (name) {
        document.getElementById('nameInputContainer').style.display = 'none';
        uploadSection.style.display = 'block';
        checkGallery();
      }
      updateClock();
    };
  </script>
</body>
</html>